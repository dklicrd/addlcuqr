<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>Escanea QR y C√≥digos de Barras</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 10px;
      background-color: #f5f5f5;
      overflow-x: hidden;
    }
    .container {
      max-width: 500px;
      margin: 0 auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 {
      text-align: center;
      color: #333;
      font-size: 1.5em;
    }
    select, button, textarea {
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 16px;
      box-sizing: border-box;
    }
    textarea {
      height: 80px;
      resize: vertical;
      font-family: Arial, sans-serif;
    }
    button {
      background-color: #007cba;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background-color: #005a87;
    }
    button:disabled {
      background-color: #cccccc;
      cursor: not-allowed;
    }
    #status {
      margin: 10px 0;
      padding: 10px;
      border-radius: 5px;
      text-align: center;
      font-weight: bold;
    }
    .success { background-color: #d4edda; color: #155724; }
    .error { background-color: #f8d7da; color: #721c24; }
    .warning { background-color: #fff3cd; color: #856404; }
    .info { background-color: #d1ecf1; color: #0c5460; }
    #result {
      margin-top: 20px;
      padding: 15px;
      background-color: #f8f9fa;
      border-radius: 5px;
      border-left: 4px solid #007cba;
    }
    #qrData {
      word-break: break-all;
      background: white;
      padding: 10px;
      border-radius: 3px;
      border: 1px solid #ddd;
    }
    .hidden {
      display: none;
    }
    .scanner-type {
      margin: 15px 0;
      text-align: center;
    }
    .scanner-type label {
      margin: 0 10px;
      cursor: pointer;
    }
    .form-group {
      margin-bottom: 15px;
    }
    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    .scanner-options {
      background-color: #f8f9fa;
      padding: 10px;
      border-radius: 5px;
      margin: 10px 0;
    }
    .scanner-options label {
      display: block;
      margin: 5px 0;
    }
    .camera-container {
      position: relative;
      width: 100%;
      margin: 10px 0;
      overflow: hidden;
      border-radius: 5px;
      background-color: #000;
    }
    #reader {
      width: 100%;
      height: 300px;
      border-radius: 5px;
      margin: 10px 0;
      background: #000;
    }
    #video {
      width: 100%;
      height: auto;
      display: none;
      object-fit: cover;
    }
    #canvas {
      display: none;
    }
    .scanner-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }
    .scan-region {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 70%;
      max-width: 250px;
      height: 0;
      padding-bottom: 70%;
      max-height: 250px;
      border: 2px solid rgba(0, 124, 186, 0.8);
      border-radius: 10px;
      box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.5);
    }
    .scan-line {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 2px;
      background: linear-gradient(to right, transparent, #ff3b30, transparent);
      animation: scanLine 2s linear infinite;
    }
    .corner {
      position: absolute;
      width: 20px;
      height: 20px;
      border: 3px solid #ff3b30;
    }
    .corner-tl {
      top: -2px;
      left: -2px;
      border-right: none;
      border-bottom: none;
    }
    .corner-tr {
      top: -2px;
      right: -2px;
      border-left: none;
      border-bottom: none;
    }
    .corner-bl {
      bottom: -2px;
      left: -2px;
      border-right: none;
      border-top: none;
    }
    .corner-br {
      bottom: -2px;
      right: -2px;
      border-left: none;
      border-top: none;
    }
    .scan-feedback {
      position: absolute;
      top: 10px;
      left: 10px;
      right: 10px;
      background-color: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 5px;
      border-radius: 5px;
      text-align: center;
      font-size: 14px;
    }
    .debug-info {
      position: absolute;
      bottom: 10px;
      left: 10px;
      right: 10px;
      background-color: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 5px;
      border-radius: 5px;
      text-align: center;
      font-size: 12px;
    }
    .redirect-message {
      margin-top: 15px;
      padding: 10px;
      background-color: #e7f3ff;
      border-radius: 5px;
      text-align: center;
      font-size: 14px;
      color: #0066cc;
    }
    .countdown {
      font-weight: bold;
      color: #ff6600;
    }
    .barcode-options {
      background-color: #f0f8ff;
      padding: 10px;
      border-radius: 5px;
      margin: 10px 0;
    }
    .barcode-options label {
      display: block;
      margin: 5px 0;
    }
    @keyframes scanLine {
      0% { top: 0; }
      100% { top: 100%; }
    }
  </style>
  <!-- Librer√≠a que funciona para QR -->
  <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
  <!-- Librer√≠a ZXing para c√≥digos de barras (m√°s robusta) -->
  <script src="https://unpkg.com/@zxing/library@latest/umd/index.min.js"></script>
</head>
<body>
  <div class="container">
    <h1>Escanea QR y C√≥digos de Barras</h1>

    <!-- SELECT DE USUARIO -->
    <div class="form-group">
      <label for="userSelect">Usuario:</label>
      <select id="userSelect" required>
        <option value="">Selecciona tu nombre</option>
        <option value="Ana">Ana</option>
        <option value="Juan">Juan</option>
        <option value="Luis">Luis</option>
        <option value="Mar√≠a">Mar√≠a</option>
        <option value="Pedro">Pedro</option>
      </select>
    </div>

    <!-- SELECT DE PROYECTO -->
    <div class="form-group">
      <label for="projectSelect">Proyecto:</label>
      <select id="projectSelect" required>
        <option value="">Selecciona el Proyecto</option>
        <option value="Hyatt">Hyatt</option>
        <option value="MAriott">MAriott</option>
        <option value="Hilton">Hilton</option>
        <option value="Magestic">Magestic</option>
        <option value="Otros">Otros</option>
      </select>
    </div>

    <!-- CAMPO DE COMENTARIOS -->
    <div class="form-group">
      <label for="comments">Comentarios (opcional):</label>
      <textarea id="comments" placeholder="Escribe aqu√≠ cualquier comentario adicional..."></textarea>
    </div>

    <!-- TIPO DE ESC√ÅNER -->
    <div class="scanner-type">
      <strong>Tipo de esc√°ner:</strong>
      <label><input type="radio" name="scannerType" value="both" checked> Ambos (QR + C√≥digos de Barras)</label>
      <label><input type="radio" name="scannerType" value="qr"> Solo QR</label>
      <label><input type="radio" name="scannerType" value="barcode"> Solo C√≥digos de Barras</label>
    </div>

    <!-- OPCIONES AVANZADAS DE ESC√ÅNEO QR -->
    <div class="scanner-options">
      <strong>Opciones avanzadas de escaneo QR:</strong>
      <label><input type="checkbox" id="invertColors" checked> Detectar QRs invertidos</label>
      <label><input type="checkbox" id="enhanceContrast"> Mejorar contraste</label>
      <label><input type="checkbox" id="debugMode"> Modo depuraci√≥n</label>
    </div>

    <!-- OPCIONES AVANZADAS DE ESC√ÅNEO DE C√ìDIGOS DE BARRAS -->
    <div class="barcode-options">
      <strong>Opciones avanzadas de c√≥digos de barras:</strong>
      <label><input type="checkbox" id="barcodeEnhance" checked> Modo de alta precisi√≥n ZXing</label>
      <label><input type="checkbox" id="barcodeMultiScan" checked> M√∫ltiples intentos</label>
      <label><input type="checkbox" id="barcodeDebug"> Modo depuraci√≥n</label>
    </div>

    <!-- C√ÅMARA Y CANVAS -->
    <div id="cameraSection" class="hidden">
      <div class="camera-container">
        <div id="reader"></div>
        <video id="video" autoplay playsinline></video>
        <canvas id="canvas"></canvas>
        <div class="scanner-overlay">
          <div class="scan-region">
            <div class="corner corner-tl"></div>
            <div class="corner corner-tr"></div>
            <div class="corner corner-bl"></div>
            <div class="corner corner-br"></div>
            <div class="scan-line"></div>
          </div>
          <div id="scanFeedback" class="scan-feedback hidden">Buscando c√≥digo QR...</div>
          <div id="debugInfo" class="debug-info hidden"></div>
        </div>
      </div>
      
      <div class="buttons">
        <button id="stopScan">Detener Escaneo</button>
      </div>
    </div>

    <!-- BOT√ìN PARA INICIAR -->
    <button id="startScan">Iniciar Escaneo</button>

    <!-- ESTADO -->
    <div id="status"></div>

    <!-- RESULTADO -->
    <div id="result" class="hidden">
      <h3>Datos Escaneados:</h3>
      <p id="qrData"></p>
      <div class="buttons">
        <button id="saveData">Guardar en Google Sheets</button>
        <button id="scanAgain">Escanear otro</button>
      </div>
      <div id="redirectMessage" class="redirect-message hidden">
        Ser√°s redirigido al formulario en <span id="countdown" class="countdown">5</span> segundos...
      </div>
    </div>
  </div>

  <script>
    // URL fija de Google Apps Script
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxGNCa7bR07OAsHxewLVXLkcJV6k8G4zJEUCYkxYyg36W_18T9jjfRwddbvmB9oTeoI/exec';
    
    // URL del formulario de Google para redirecci√≥n
    const GOOGLE_FORM_URL = 'https://forms.gle/HJGdSzr79Mf79ibH6';

    // Elementos DOM
    const userSelect = document.getElementById('userSelect');
    const projectSelect = document.getElementById('projectSelect');
    const commentsInput = document.getElementById('comments');
    const startScanBtn = document.getElementById('startScan');
    const stopScanBtn = document.getElementById('stopScan');
    const saveDataBtn = document.getElementById('saveData');
    const scanAgainBtn = document.getElementById('scanAgain');
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const canvasContext = canvas.getContext('2d');
    const statusDiv = document.getElementById('status');
    const resultDiv = document.getElementById('result');
    const qrDataDiv = document.getElementById('qrData');
    const cameraSection = document.getElementById('cameraSection');
    const scannerTypeRadios = document.querySelectorAll('input[name="scannerType"]');
    const scanFeedback = document.getElementById('scanFeedback');
    const debugInfo = document.getElementById('debugInfo');
    const redirectMessage = document.getElementById('redirectMessage');
    const countdownSpan = document.getElementById('countdown');
    
    // Opciones de escaneo
    const invertColorsCheckbox = document.getElementById('invertColors');
    const enhanceContrastCheckbox = document.getElementById('enhanceContrast');
    const debugModeCheckbox = document.getElementById('debugMode');
    
    // Opciones de c√≥digos de barras
    const barcodeEnhanceCheckbox = document.getElementById('barcodeEnhance');
    const barcodeMultiScanCheckbox = document.getElementById('barcodeMultiScan');
    const barcodeDebugCheckbox = document.getElementById('barcodeDebug');

    let stream = null;
    let scanning = false;
    let currentQRData = '';
    let html5QrCode = null;
    let redirectTimer = null;
    let barcodeScanInterval = null;
    let codeReader = null;

    // Funci√≥n para mostrar mensajes de estado
    function showStatus(message, type = 'info') {
      statusDiv.textContent = message;
      statusDiv.className = type;
      statusDiv.style.display = 'block';
    }

    // Funci√≥n para ocultar mensajes de estado
    function hideStatus() {
      statusDiv.style.display = 'none';
    }

    // Obtener tipo de esc√°ner seleccionado
    function getScannerType() {
      for (const radio of scannerTypeRadios) {
        if (radio.checked) return radio.value;
      }
      return 'both';
    }

    // Funci√≥n para preprocesar imagen para c√≥digos de barras
    function preprocessImageForBarcode(imageData) {
      const data = imageData.data;
      const width = imageData.width;
      const height = imageData.height;
      
      // Convertir a escala de grises
      for (let i = 0; i < data.length; i += 4) {
        const gray = data[i] * 0.299 + data[i + 1] * 0.587 + data[i + 2] * 0.114;
        data[i] = gray;
        data[i + 1] = gray;
        data[i + 2] = gray;
      }
      
      // Mejorar contraste para c√≥digos de barras
      if (barcodeEnhanceCheckbox.checked) {
        // Calcular histograma
        const histogram = new Array(256).fill(0);
        for (let i = 0; i < data.length; i += 4) {
          histogram[data[i]]++;
        }
        
        // Encontrar umbral √≥ptimo usando el m√©todo de Otsu
        let sum = 0;
        for (let i = 0; i < 256; i++) {
          sum += i * histogram[i];
        }
        
        let sumB = 0;
        let wB = 0;
        let wF = 0;
        let maxVariance = 0;
        let threshold = 0;
        
        for (let i = 0; i < 256; i++) {
          wB += histogram[i];
          if (wB === 0) continue;
          
          wF = width * height - wB;
          if (wF === 0) break;
          
          sumB += i * histogram[i];
          const mB = sumB / wB;
          const mF = (sum - sumB) / wF;
          
          const variance = wB * wF * (mB - mF) * (mB - mF);
          
          if (variance > maxVariance) {
            maxVariance = variance;
            threshold = i;
          }
        }
        
        // Aplicar umbral
        for (let i = 0; i < data.length; i += 4) {
          const value = data[i] > threshold ? 255 : 0;
          data[i] = value;
          data[i + 1] = value;
          data[i + 2] = value;
        }
      }
      
      return imageData;
    }

    // Funci√≥n para escanear c√≥digos de barras con ZXing
    async function scanBarcodeWithZXing() {
      if (!scanning || getScannerType() === 'qr' || !video || video.readyState !== video.HAVE_ENOUGH_DATA) return;
      
      try {
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        canvasContext.drawImage(video, 0, 0, canvas.width, canvas.height);
        
        const imageData = canvasContext.getImageData(0, 0, canvas.width, canvas.height);
        const processedImageData = preprocessImageForBarcode(imageData);
        
        // Crear un ImageData para ZXing
        const luminanceSource = new ZXing.HTMLCanvasElementLuminanceSource(canvas);
        const binaryBitmap = new ZXing.BinaryBitmap(new ZXing.HybridBinarizer(luminanceSource));
        
        // Intentar leer con m√∫ltiples formatos
        const formats = [
          ZXing.BarcodeFormat.CODE_128,
          ZXing.BarcodeFormat.CODE_39,
          ZXing.BarcodeFormat.EAN_13,
          ZXing.BarcodeFormat.EAN_8,
          ZXing.BarcodeFormat.UPC_A,
          ZXing.BarcodeFormat.UPC_E,
          ZXing.BarcodeFormat.CODE_93,
          ZXing.BarcodeFormat.CODE_32,
          ZXing.BarcodeFormat.ITF,
          ZXing.BarcodeFormat.CODABAR
        ];
        
        const hints = new Map();
        hints.set(ZXing.DecodeHintType.TRY_HARDER, barcodeEnhanceCheckbox.checked);
        hints.set(ZXing.DecodeHintType.POSSIBLE_FORMATS, formats);
        
        if (barcodeMultiScanCheckbox.checked) {
          hints.set(ZXing.DecodeHintType.TRY_HARDER, true);
        }
        
        const result = await codeReader.decodeBitmap(binaryBitmap, hints);
        
        if (result && result.text) {
          if (barcodeDebugCheckbox.checked) {
            debugInfo.textContent = `C√≥digo detectado con ZXing: ${result.text}`;
          }
          handleScannedCode(result.text, 'C√≥digo de barras');
        }
      } catch (err) {
        // Silenciar errores para no inundar la consola
        if (barcodeDebugCheckbox.checked && err.name !== 'NotFoundException') {
          debugInfo.textContent = `Error ZXing: ${err.message}`;
        }
      }
    }

    // Funci√≥n para manejar c√≥digo escaneado
    function handleScannedCode(code, type) {
      const now = Date.now();
      if (now - lastScanTime < SCAN_COOLDOWN) {
        return; // Evitar escaneos duplicados
      }
      
      lastScanTime = now;
      currentQRData = code;
      showQRResult(currentQRData, type);
      stopCamera();
    }

    // Funci√≥n para iniciar la c√°mara
    async function startCamera() {
      // Validar selecciones
      if (!userSelect.value) {
        showStatus('Por favor selecciona un usuario', 'error');
        return;
      }
      
      if (!projectSelect.value) {
        showStatus('Por favor selecciona un proyecto', 'error');
        return;
      }

      try {
        showStatus('Iniciando c√°mara...', 'info');
        
        cameraSection.classList.remove('hidden');
        startScanBtn.classList.add('hidden');
        scanning = true;
        
        hideStatus();
        scanFeedback.classList.remove('hidden');
        
        if (debugModeCheckbox.checked || barcodeDebugCheckbox.checked) {
          debugInfo.classList.remove('hidden');
        }
        
        // Inicializar esc√°ner seg√∫n el tipo seleccionado
        const scannerType = getScannerType();
        
        if (scannerType !== 'barcode') {
          // Inicializar html5-qrcode para QR
          html5QrCode = new Html5Qrcode("reader");
          
          const config = { 
            fps: 10, 
            qrbox: { width: 250, height: 250 },
            aspectRatio: 1.0,
            // Configuraci√≥n para detectar QRs invertidos
            experimentalFeatures: {
              useBarCodeDetectorIfSupported: true
            }
          };
          
          await html5QrCode.start(
            { facingMode: "environment" },
            config,
            (decodedText, decodedResult) => {
              // Determinar el tipo de c√≥digo
              const format = decodedResult.result.format.formatName;
              const type = format.includes('QR') ? 'QR' : 'C√≥digo de barras';
              
              if (debugModeCheckbox.checked) {
                debugInfo.textContent = `${type} detectado: ${decodedText.substring(0, 20)}...`;
              }
              
              // Solo procesar si coincide con el tipo de esc√°ner seleccionado
              if (type === 'QR' && getScannerType() !== 'barcode') {
                handleScannedCode(decodedText, 'QR');
              } else if (type === 'C√≥digo de barras' && getScannerType() !== 'qr') {
                handleScannedCode(decodedText, 'C√≥digo de barras');
              }
            },
            (errorMessage) => {
              // Error continuo (no cr√≠tico)
              if (debugModeCheckbox.checked && frameCount % 30 === 0) {
                debugInfo.textContent = `Error: ${errorMessage}`;
              }
            }
          ).then(() => {
            scanFeedback.textContent = "üéØ Apunta al c√≥digo con la c√°mara";
          }).catch(err => {
            showStatus(`Error al iniciar esc√°ner: ${err}`, 'error');
            console.error("Error al iniciar html5-qrcode:", err);
          });
        }
        
        if (scannerType !== 'qr') {
          // Inicializar ZXing para c√≥digos de barras
          video.style.display = 'block';
          scanFeedback.textContent = "üéØ Apunta al c√≥digo de barras con la c√°mara";
          
          // Inicializar ZXing
          codeReader = new ZXing.BrowserMultiFormatReader();
          
          // Iniciar escaneo peri√≥dico con ZXing
          barcodeScanInterval = setInterval(scanBarcodeWithZXing, 300);
        }
        
      } catch (error) {
        showStatus('Error al acceder a la c√°mara: ' + error.message, 'error');
        console.error("Error al iniciar c√°mara:", error);
      }
    }

    // Funci√≥n para detener la c√°mara
    function stopCamera() {
      if (html5QrCode) {
        html5QrCode.stop().then(() => {
          html5QrCode = null;
        }).catch(err => {
          console.error("Error al detener html5-qrcode:", err);
        });
      }
      
      if (barcodeScanInterval) {
        clearInterval(barcodeScanInterval);
        barcodeScanInterval = null;
      }
      
      if (codeReader) {
        codeReader.reset();
        codeReader = null;
      }
      
      if (stream) {
        stream.getTracks().forEach(track => track.stop());
        stream = null;
      }
      
      scanning = false;
      cameraSection.classList.add('hidden');
      startScanBtn.classList.remove('hidden');
      scanFeedback.classList.add('hidden');
      debugInfo.classList.add('hidden');
      video.style.display = 'none';
      hideStatus();
    }

    // Funci√≥n para mostrar resultado del QR
    function showQRResult(data, type) {
      qrDataDiv.innerHTML = `<strong>Tipo:</strong> ${type}<br><strong>Datos:</strong> ${data}`;
      resultDiv.classList.remove('hidden');
      showStatus(`${type} detectado correctamente`, 'success');
      
      // Vibrar (m√≥viles)
      if (navigator.vibrate) navigator.vibrate(200);
    }

    // Funci√≥n para redirigir al formulario de Google
    function redirectToGoogleForm() {
      redirectMessage.classList.remove('hidden');
      let countdown = 5;
      countdownSpan.textContent = countdown;
      
      redirectTimer = setInterval(() => {
        countdown--;
        countdownSpan.textContent = countdown;
        
        if (countdown <= 0) {
          clearInterval(redirectTimer);
          window.location.href = GOOGLE_FORM_URL;
        }
      }, 1000);
    }

    // Funci√≥n para guardar datos en Google Sheets
    async function saveToGoogleSheets() {
      const user = userSelect.value;
      const project = projectSelect.value;
      const qrData = currentQRData;
      const comments = commentsInput.value.trim();

      // Validaciones
      if (!user) {
        showStatus('Por favor selecciona un usuario', 'error');
        return;
      }
      
      if (!project) {
        showStatus('Por favor selecciona un proyecto', 'error');
        return;
      }
      
      if (!qrData) {
        showStatus('No hay datos para guardar', 'error');
        return;
      }

      saveDataBtn.disabled = true;
      showStatus('Guardando datos...', 'info');

      try {
        // Crear datos del formulario
        const formData = new URLSearchParams();
        formData.append('user', user);
        formData.append('project', project);
        formData.append('qrData', qrData);
        formData.append('comments', comments);

        console.log('Enviando datos a:', SCRIPT_URL);
        console.log('Datos:', { user, project, qrData, comments });

        const response = await fetch(SCRIPT_URL, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'
          },
          body: formData.toString()
        });

        console.log('Respuesta recibida, status:', response.status);

        if (!response.ok) {
          throw new Error(`Error HTTP: ${response.status} ${response.statusText}`);
        }

        const result = await response.text();
        console.log('Resultado:', result);

        if (result.includes('√âXITO')) {
          showStatus('‚úì Datos guardados exitosamente en Google Sheets', 'success');
          
          // Iniciar cuenta regresiva para redirecci√≥n
          redirectToGoogleForm();
          
        } else if (result.includes('DUPLICADO')) {
          showStatus('‚ö† Este c√≥digo ya fue escaneado anteriormente', 'warning');
          saveDataBtn.disabled = false;
        } else {
          showStatus('‚úó Error al guardar: ' + result, 'error');
          saveDataBtn.disabled = false;
        }
      } catch (error) {
        console.error('Error completo:', error);
        showStatus('‚úó Error de conexi√≥n: ' + error.message, 'error');
        saveDataBtn.disabled = false;
      }
    }

    // Event Listeners
    startScanBtn.addEventListener('click', startCamera);
    stopScanBtn.addEventListener('click', stopCamera);
    saveDataBtn.addEventListener('click', saveToGoogleSheets);
    
    scanAgainBtn.addEventListener('click', function() {
      // Limpiar cualquier temporizador de redirecci√≥n activo
      if (redirectTimer) {
        clearInterval(redirectTimer);
        redirectTimer = null;
      }
      
      resultDiv.classList.add('hidden');
      redirectMessage.classList.add('hidden');
      currentQRData = '';
      hideStatus();
      startCamera();
    });

    // Validar selecciones al cambiar
    userSelect.addEventListener('change', hideStatus);
    projectSelect.addEventListener('change', hideStatus);

    // Event listener para el modo de depuraci√≥n
    debugModeCheckbox.addEventListener('change', function() {
      if (this.checked && scanning) {
        debugInfo.classList.remove('hidden');
      } else {
        debugInfo.classList.add('hidden');
      }
    });
    
    // Event listener para el modo de depuraci√≥n de c√≥digos de barras
    barcodeDebugCheckbox.addEventListener('change', function() {
      if (this.checked && scanning && getScannerType() !== 'qr') {
        debugInfo.classList.remove('hidden');
      } else {
        debugInfo.classList.add('hidden');
      }
    });
  </script>
</body>
</html>
